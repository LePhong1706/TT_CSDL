@model IEnumerable<Web_vuottai.Models.v_VuotTai_TongQuan>

@{
    ViewData["Title"] = "Tổng quan vượt tải";
    // Lấy lại giá trị filter từ Controller
    string? hoTenFilter = ViewData["HoTenFilter"] as string;
    int? selHk = ViewBag.HocKy as int?;
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">@ViewData["Title"]</h3>
    </div>
    <div class="card-body">

        <!-- ===== FORM LỌC MỚI (5 trường) ===== -->
        <form asp-action="Index" method="get" class="row g-3 mb-3 align-items-end p-3 border rounded-3">
            
            <!-- Hàng 1 -->
            <div class="col-md-4">
                <label class="form-label" for="hoTen">Họ tên</label>
                <input type="text" name="hoTen" id="hoTen" class="form-control" value="@hoTenFilter" placeholder="Tìm theo họ tên..."/>
            </div>
            <div class="col-md-4">
                <label class="form-label" for="chucDanh">Chức danh</label>
                <select name="chucDanh" id="chucDanh" class="form-select" asp-items="ViewBag.ChucDanhList"></select>
            </div>
            <div class="col-md-4">
                <label class="form-label" for="chucVu">Chức vụ</label>
                <select name="chucVu" id="chucVu" class="form-select" asp-items="ViewBag.ChucVuList"></select>
            </div>

            <!-- Hàng 2 -->
            <div class="col-md-4 mt-3">
                <label class="form-label" for="namHoc">Năm học</label>
                <select name="namHoc" id="namHoc" class="form-select" asp-items="ViewBag.NamHocList"></select>
            </div>
            <div class="col-md-4 mt-3">
                <label class="form-label" for="hocKy">Học kỳ</label>
                <select name="hocKy" id="hocKy" class="form-select">
                    <option value="" selected="@(selHk == null)">Cả năm</option>
                    <option value="1" selected="@(selHk == 1)">Học kỳ 1</option>
                    <option value="2" selected="@(selHk == 2)">Học kỳ 2</option>
                </select>
            </div>
            <div class="col-md-4 mt-3 d-flex align-items-end gap-2">
                <button class="btn btn-primary" type="submit">Lọc</button>
                <a asp-action="Index" class="btn btn-secondary">Làm mới</a>
            </div>
        </form>
        <!-- ===== KẾT THÚC FORM ===== -->

        <table class="table table-striped table-bordered">
            <!-- ... (Phần <thead> và <tbody> của bạn giữ nguyên) ... -->
            <thead>
                <tr>
                    <th>Họ tên</th>
                    <th>Chức danh</th>
                    <th>Chức vụ</th>
                    <th>Năm học</th>
                    <th>Học kỳ</th>
                    <th>Giờ chuẩn</th>
                    <th>Giờ thực tế</th>
                    <th>Giờ vượt tải</th>
                    <th>Thành tiền</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var r in Model)
                {
                    <tr>
                        <td>@r.HoTen</td>
                        <td>@r.TenChucDanh</td>
                        <td>@r.TenChucVu</td>
                        <td>@r.NamHoc</td>
                        <td>@r.HocKy</td>
                        <td>@r.GioChuan</td>
                        <td>@r.GioThucTe</td>
                        <td>@r.GioVuot</td>
                        <td>@r.ThanhTien?.ToString("N0")</td> <!-- Thêm định dạng tiền tệ (N0) -->
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>